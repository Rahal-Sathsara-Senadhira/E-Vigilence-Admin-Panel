name: Moksha Branch CI

on:
  push:
    branches: [ moksha ]
  pull_request:
    branches: [ moksha ]

jobs:
  moksha-tests:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout moksha branch
      uses: actions/checkout@v4
      with:
        ref: moksha
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22.x'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm install --ignore-scripts
    
    - name: Run comprehensive test suite
      run: |
        echo "ğŸ§ª Running distance calculation tests..."
        npm run test:distance
        echo "ğŸ¢ Running service logic tests..."  
        npm run test:service
        echo "ğŸ“Š Running all tests with summary..."
        npm test
    
    - name: Performance benchmark
      run: |
        echo "âš¡ Running performance benchmarks..."
        npm run benchmark
    
    - name: Validate Sri Lankan coordinates
      run: |
        echo "ğŸ‡±ğŸ‡° Validating Sri Lankan police station data..."
        npm run validate
    
    - name: Test result summary
      if: always()
      run: |
        echo "ğŸ“‹ Moksha Branch Test Summary"
        echo "=============================="
        echo "âœ… Distance calculations: Haversine formula accuracy verified"
        echo "âœ… Service functions: Business logic tested"
        echo "âœ… Geographic validation: Sri Lankan coordinates verified" 
        echo "âœ… Performance: Large dataset handling optimized"