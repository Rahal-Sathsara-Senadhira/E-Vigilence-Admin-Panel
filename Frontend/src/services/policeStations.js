// Comprehensive list of Police Stations in Sri Lanka
// Coordinates are approximate for demonstration purposes

export const POLICE_STATIONS = [
  // --- Colombo District ---
  { name: "Police Headquarters (Colombo)", lat: 6.9361, lng: 79.8436, area: "Colombo Fort" },
  { name: "Pettah Police Station", lat: 6.9366, lng: 79.8480, area: "Colombo" },
  { name: "Fort Police Station", lat: 6.9333, lng: 79.8430, area: "Colombo" },
  { name: "Maradana Police Station", lat: 6.9290, lng: 79.8665, area: "Colombo" },
  { name: "Borella Police Station", lat: 6.9147, lng: 79.8778, area: "Colombo" },
  { name: "Cinnamon Gardens Police Station", lat: 6.9126, lng: 79.8647, area: "Colombo" },
  { name: "Kollupitiya Police Station", lat: 6.9080, lng: 79.8520, area: "Colombo" },
  { name: "Bambalapitiya Police Station", lat: 6.8960, lng: 79.8560, area: "Colombo" },
  { name: "Wellawatte Police Station", lat: 6.8744, lng: 79.8610, area: "Colombo" },
  { name: "Narahenpita Police Station", lat: 6.8922, lng: 79.8763, area: "Colombo" },
  { name: "Kirulapone Police Station", lat: 6.8789, lng: 79.8805, area: "Colombo" },
  { name: "Havelock Town Police Station", lat: 6.8845, lng: 79.8650, area: "Colombo" },
  { name: "Dematagoda Police Station", lat: 6.9350, lng: 79.8800, area: "Colombo" },
  { name: "Grandpass Police Station", lat: 6.9480, lng: 79.8750, area: "Colombo" },
  { name: "Kotahena Police Station", lat: 6.9455, lng: 79.8600, area: "Colombo" },
  { name: "Modara Police Station", lat: 6.9550, lng: 79.8650, area: "Colombo" },
  { name: "Mattakkuliya Police Station", lat: 6.9650, lng: 79.8750, area: "Colombo" },
  
  // --- Colombo Suburbs ---
  { name: "Mount Lavinia Police Station", lat: 6.8293, lng: 79.8656, area: "Mount Lavinia" },
  { name: "Dehiwala Police Station", lat: 6.8511, lng: 79.8652, area: "Dehiwala" },
  { name: "Nugegoda Police Station", lat: 6.8649, lng: 79.8997, area: "Nugegoda" },
  { name: "Mirihana Police Station", lat: 6.8774, lng: 79.9142, area: "Nugegoda" },
  { name: "Maharagama Police Station", lat: 6.8480, lng: 79.9265, area: "Maharagama" },
  { name: "Kottawa Police Station", lat: 6.8385, lng: 79.9650, area: "Kottawa" },
  { name: "Homagama Police Station", lat: 6.8436, lng: 80.0022, area: "Homagama" },
  { name: "Piliyandala Police Station", lat: 6.8018, lng: 79.9227, area: "Piliyandala" },
  { name: "Moratuwa Police Station", lat: 6.7728, lng: 79.8800, area: "Moratuwa" },
  { name: "Kohuwala Police Station", lat: 6.8600, lng: 79.8850, area: "Nugegoda" },
  { name: "Boralesgamuwa Police Station", lat: 6.8450, lng: 79.9050, area: "Boralesgamuwa" },
  { name: "Welamboda Police Station", lat: 6.9400, lng: 79.9400, area: "Kolonnawa" }, // Approx
  { name: "Mulleriyawa Police Station", lat: 6.9311, lng: 79.9322, area: "Mulleriyawa" },
  
  // --- Gampaha District ---
  { name: "Gampaha Police Station", lat: 7.0873, lng: 79.9928, area: "Gampaha" },
  { name: "Negombo Police Station", lat: 7.2008, lng: 79.8407, area: "Negombo" },
  { name: "Kelaniya Police Station", lat: 6.9580, lng: 79.9150, area: "Kelaniya" },
  { name: "Peliyagoda Police Station", lat: 6.9630, lng: 79.8900, area: "Peliyagoda" },
  { name: "Kiribathgoda Police Station", lat: 6.9750, lng: 79.9250, area: "Kiribathgoda" },
  { name: "Mahara Police Station", lat: 6.9950, lng: 79.9350, area: "Mahara" }, // Kadawatha
  { name: "Kadawatha Police Station", lat: 7.0016, lng: 79.9511, area: "Kadawatha" },
  { name: "Ragama Police Station", lat: 7.0300, lng: 79.9150, area: "Ragama" },
  { name: "Wattala Police Station", lat: 6.9850, lng: 79.8950, area: "Wattala" },
  { name: "Ja-Ela Police Station", lat: 7.0750, lng: 79.8920, area: "Ja-Ela" },
  { name: "Seeduwa Police Station", lat: 7.1200, lng: 79.8850, area: "Seeduwa" },
  { name: "Minuwangoda Police Station", lat: 7.1700, lng: 79.9500, area: "Minuwangoda" },
  { name: "Veyangoda Police Station", lat: 7.1500, lng: 80.0500, area: "Veyangoda" },
  { name: "Nittambuwa Police Station", lat: 7.1436, lng: 80.0980, area: "Nittambuwa" },
  { name: "Mirigama Police Station", lat: 7.2450, lng: 80.1250, area: "Mirigama" },
  
  // --- Kalutara District ---
  { name: "Kalutara North Police Station", lat: 6.5950, lng: 79.9620, area: "Kalutara" },
  { name: "Kalutara South Police Station", lat: 6.5800, lng: 79.9600, area: "Kalutara" },
  { name: "Panadura North Police Station", lat: 6.7250, lng: 79.9050, area: "Panadura" },
  { name: "Panadura South Police Station", lat: 6.7100, lng: 79.9080, area: "Panadura" },
  { name: "Wadduwa Police Station", lat: 6.6600, lng: 79.9300, area: "Wadduwa" },
  { name: "Beruwala Police Station", lat: 6.4750, lng: 79.9850, area: "Beruwala" },
  { name: "Aluthgama Police Station", lat: 6.4350, lng: 80.0000, area: "Aluthgama" },
  { name: "Matugama Police Station", lat: 6.5200, lng: 80.1150, area: "Matugama" },
  { name: "Horana Police Station", lat: 6.7150, lng: 80.0630, area: "Horana" },
  { name: "Bandaragama Police Station", lat: 6.7100, lng: 79.9900, area: "Bandaragama" },
  
  // --- Galle District ---
  { name: "Galle Police Station", lat: 6.0329, lng: 80.2168, area: "Galle" },
  { name: "Karapitiya Police Station", lat: 6.0629, lng: 80.2289, area: "Galle" },
  { name: "Unawatuna Police Station", lat: 6.0105, lng: 80.2464, area: "Unawatuna" },
  { name: "Hikkaduwa Police Station", lat: 6.1400, lng: 80.1000, area: "Hikkaduwa" },
  { name: "Ambalangoda Police Station", lat: 6.2350, lng: 80.0550, area: "Ambalangoda" },
  { name: "Bentota Police Station", lat: 6.4200, lng: 80.0050, area: "Bentota" },
  { name: "Baddegama Police Station", lat: 6.1850, lng: 80.1750, area: "Baddegama" },
  { name: "Elpitiya Police Station", lat: 6.2600, lng: 80.1400, area: "Elpitiya" },
  { name: "Ahangama Police Station", lat: 5.9700, lng: 80.3650, area: "Ahangama" },
  { name: "Koggala Police Station", lat: 5.9900, lng: 80.3200, area: "Koggala" },
  
  // --- Matara District ---
  { name: "Matara Police Station", lat: 5.9496, lng: 80.5480, area: "Matara" },
  { name: "Weligama Police Station", lat: 5.9750, lng: 80.4280, area: "Weligama" },
  { name: "Dickwella Police Station", lat: 5.9650, lng: 80.6900, area: "Dickwella" },
  { name: "Gandara Police Station", lat: 5.9400, lng: 80.6000, area: "Gandara" },
  { name: "Kamburupitiya Police Station", lat: 6.0800, lng: 80.5600, area: "Kamburupitiya" },
  { name: "Akuressa Police Station", lat: 6.0950, lng: 80.4750, area: "Akuressa" },
  { name: "Deniyaya Police Station", lat: 6.3400, lng: 80.5550, area: "Deniyaya" },
  
  // --- Hambantota District ---
  { name: "Hambantota Police Station", lat: 6.1200, lng: 81.1200, area: "Hambantota" },
  { name: "Tangalle Police Station", lat: 6.0250, lng: 80.7950, area: "Tangalle" },
  { name: "Ambalantota Police Station", lat: 6.1150, lng: 81.0250, area: "Ambalantota" },
  { name: "Tissamaharama Police Station", lat: 6.2800, lng: 81.2850, area: "Tissamaharama" },
  { name: "Kataragama Police Station", lat: 6.4150, lng: 81.3350, area: "Kataragama" },
  { name: "Beliatta Police Station", lat: 6.0400, lng: 80.7350, area: "Beliatta" },

  // --- Kandy District ---
  { name: "Kandy Police Station", lat: 7.2906, lng: 80.6337, area: "Kandy" },
  { name: "Katugastota Police Station", lat: 7.3200, lng: 80.6150, area: "Katugastota" },
  { name: "Peradeniya Police Station", lat: 7.2650, lng: 80.5950, area: "Peradeniya" },
  { name: "Gampola Police Station", lat: 7.1650, lng: 80.5650, area: "Gampola" },
  { name: "Nawalapitiya Police Station", lat: 7.0500, lng: 80.5350, area: "Nawalapitiya" },
  { name: "Teldeniya Police Station", lat: 7.3000, lng: 80.7650, area: "Teldeniya" },
  { name: "Wattegama Police Station", lat: 7.3500, lng: 80.6800, area: "Wattegama" },
  { name: "Pallekele Police Station", lat: 7.2800, lng: 80.6900, area: "Pallekele" },
  { name: "Alawatugoda Police Station", lat: 7.3900, lng: 80.6200, area: "Alawatugoda" },
  { name: "Kadugannawa Police Station", lat: 7.2540, lng: 80.5280, area: "Kadugannawa" },
  { name: "Menikhinna Police Station", lat: 7.2950, lng: 80.7100, area: "Menikhinna" },

  // --- Matale District ---
  { name: "Matale Police Station", lat: 7.4675, lng: 80.6234, area: "Matale" },
  { name: "Dambulla Police Station", lat: 7.8742, lng: 80.6511, area: "Dambulla" },
  { name: "Sigiriya Police Station", lat: 7.9541, lng: 80.7547, area: "Sigiriya" },
  { name: "Galewela Police Station", lat: 7.7712, lng: 80.5630, area: "Galewela" },
  { name: "Rattota Police Station", lat: 7.5131, lng: 80.6865, area: "Rattota" },
  { name: "Yatawatta Police Station", lat: 7.5500, lng: 80.6500, area: "Yatawatta" },
  { name: "Naula Police Station", lat: 7.7000, lng: 80.6500, area: "Naula" },

  // --- Nuwara Eliya District ---
  { name: "Nuwara Eliya Police Station", lat: 6.9497, lng: 80.7891, area: "Nuwara Eliya" },
  { name: "Hatton Police Station", lat: 6.8916, lng: 80.5966, area: "Hatton" },
  { name: "Talawakele Police Station", lat: 6.9365, lng: 80.6558, area: "Talawakele" },
  { name: "Nanu Oya Police Station", lat: 6.9333, lng: 80.7500, area: "Nanu Oya" },
  { name: "Maskeliya Police Station", lat: 6.8333, lng: 80.5667, area: "Maskeliya" },
  { name: "Ginigathena Police Station", lat: 6.9880, lng: 80.4870, area: "Ginigathena" },
  { name: "Ragala Police Station", lat: 6.9800, lng: 80.8000, area: "Ragala" },
  { name: "Walapane Police Station", lat: 7.0500, lng: 80.8600, area: "Walapane" },

  // --- Galle District ---
  { name: "Kurunegala Police Station", lat: 7.4863, lng: 80.3647, area: "Kurunegala" },
  { name: "Wariyapola Police Station", lat: 7.6150, lng: 80.2300, area: "Wariyapola" },
  { name: "Kuliyapitiya Police Station", lat: 7.4700, lng: 80.0450, area: "Kuliyapitiya" },
  { name: "Narammala Police Station", lat: 7.4350, lng: 80.2150, area: "Narammala" },
  { name: "Polgahawela Police Station", lat: 7.3350, lng: 80.2950, area: "Polgahawela" },  { name: "Nikaweratiya Police Station", lat: 7.7500, lng: 80.1167, area: "Nikaweratiya" },
  { name: "Pannala Police Station", lat: 7.3333, lng: 79.9833, area: "Pannala" },
  { name: "Giriulla Police Station", lat: 7.3300, lng: 80.1200, area: "Giriulla" },

  // --- Puttalam District ---
  { name: "Puttalam Police Station", lat: 8.0330, lng: 79.8260, area: "Puttalam" },
  { name: "Chilaw Police Station", lat: 7.5758, lng: 79.7953, area: "Chilaw" },
  { name: "Marawila Police Station", lat: 7.4167, lng: 79.8167, area: "Marawila" },
  { name: "Wennappuwa Police Station", lat: 7.3500, lng: 79.8500, area: "Wennappuwa" },
  { name: "Dankotuwa Police Station", lat: 7.3000, lng: 79.8833, area: "Dankotuwa" },
  { name: "Anamaduwa Police Station", lat: 7.9667, lng: 80.0500, area: "Anamaduwa" },
  { name: "Kalpitiya Police Station", lat: 8.2333, lng: 79.7667, area: "Kalpitiya" },  
  // --- North & East ---
  { name: "Jaffna Police Station", lat: 9.6615, lng: 80.0255, area: "Jaffna" },
  { name: "Chunnakam Police Station", lat: 9.7450, lng: 80.0150, area: "Chunnakam" },
  { name: "Kankesanthurai Police Station", lat: 9.8150, lng: 80.0400, area: "KKS" },
  { name: "Chavakachcheri Police Station", lat: 9.6550, lng: 80.1550, area: "Chavakachcheri" },
  { name: "Kopay Police Station", lat: 9.7000, lng: 80.0600, area: "Kopay" }, // Approx
  { name: "Manipay Police Station", lat: 9.7100, lng: 79.9900, area: "Manipay" }, // Approx
  { name: "Point Pedro Police Station", lat: 9.8252, lng: 80.2330, area: "Point Pedro" },
  { name: "Nelliyadi Police Station", lat: 9.7800, lng: 80.1800, area: "Nelliyadi" },

  // --- Kilinochchi District ---
  { name: "Kilinochchi Police Station", lat: 9.3900, lng: 80.4000, area: "Kilinochchi" },
  { name: "Mankulam Police Station", lat: 9.1235, lng: 80.4560, area: "Mankulam" },
  { name: "Pooneryn Police Station", lat: 9.5000, lng: 80.2000, area: "Pooneryn" },

  // --- Mullaitivu District ---
  { name: "Mullaitivu Police Station", lat: 9.2678, lng: 80.8140, area: "Mullaitivu" },
  { name: "Mallavi Police Station", lat: 9.1300, lng: 80.2900, area: "Mallavi" },
  { name: "Puthukudiyiruppu Police Station", lat: 9.3000, lng: 80.7000, area: "Puthukudiyiruppu" },
  { name: "Oddusuddan Police Station", lat: 9.1550, lng: 80.6500, area: "Oddusuddan" },

  // --- Vavuniya District ---
  { name: "Vavuniya Police Station", lat: 8.7514, lng: 80.4971, area: "Vavuniya" },
  { name: "Cheddikulam Police Station", lat: 8.6800, lng: 80.3100, area: "Cheddikulam" },

  // --- Mannar District ---
  { name: "Mannar Police Station", lat: 8.9770, lng: 79.9100, area: "Mannar" },
  { name: "Talaimannar Police Station", lat: 9.1000, lng: 79.7300, area: "Talaimannar" },
  { name: "Murunkan Police Station", lat: 8.8500, lng: 80.0300, area: "Murunkan" },

  // --- Trincomalee District ---
  { name: "Trincomalee Police Station", lat: 8.5711, lng: 81.2335, area: "Trincomalee" },
  { name: "Kinniya Police Station", lat: 8.4833, lng: 81.1833, area: "Kinniya" },
  { name: "Kantale Police Station", lat: 8.3667, lng: 80.9833, area: "Kantale" },
  { name: "China Bay Police Station", lat: 8.5400, lng: 81.1800, area: "China Bay" },
  { name: "Uppuveli Police Station", lat: 8.6000, lng: 81.2100, area: "Uppuveli" },

  // --- Batticaloa District ---
  { name: "Batticaloa Police Station", lat: 7.7170, lng: 81.7000, area: "Batticaloa" },
  { name: "Eravur Police Station", lat: 7.7667, lng: 81.6000, area: "Eravur" },
  { name: "Kattankudy Police Station", lat: 7.6900, lng: 81.7200, area: "Kattankudy" },
  { name: "Valaichchenai Police Station", lat: 7.9200, lng: 81.5300, area: "Valaichchenai" },

  // --- Ampara District ---
  { name: "Ampara Police Station", lat: 7.2830, lng: 81.6660, area: "Ampara" },
  { name: "Kalmunai Police Station", lat: 7.4167, lng: 81.8333, area: "Kalmunai" },
  { name: "Sammanturai Police Station", lat: 7.3667, lng: 81.8000, area: "Sammanturai" },
  { name: "Akkaraipattu Police Station", lat: 7.2167, lng: 81.8500, area: "Akkaraipattu" },
  { name: "Pottuvil Police Station", lat: 6.8667, lng: 81.8333, area: "Pottuvil" },

  // --- North Central ---
  { name: "Anuradhapura Police Station", lat: 8.3114, lng: 80.4037, area: "Anuradhapura" },
  { name: "Mihintale Police Station", lat: 8.3500, lng: 80.5050, area: "Mihintale" },
  { name: "Kekirawa Police Station", lat: 8.0450, lng: 80.5850, area: "Kekirawa" },
  { name: "Polonnaruwa Police Station", lat: 7.9403, lng: 81.0188, area: "Polonnaruwa" },
  { name: "Medirigiriya Police Station", lat: 8.1500, lng: 81.0000, area: "Medirigiriya" },
  { name: "Hingurakgoda Police Station", lat: 8.0560, lng: 80.9780, area: "Hingurakgoda" },
  { name: "Aralaganwila Police Station", lat: 7.9710, lng: 81.1640, area: "Aralaganwila" },
  { name: "Welikanda Police Station", lat: 7.9740, lng: 81.2330, area: "Welikanda" },

  // --- Uva & Sabaragamuwa ---
  { name: "Badulla Police Station", lat: 6.9893, lng: 81.0550, area: "Badulla" },
  { name: "Bandarawela Police Station", lat: 6.8300, lng: 80.9900, area: "Bandarawela" },
  { name: "Ella Police Station", lat: 6.8667, lng: 81.0467, area: "Ella" },
  { name: "Mahiyanganaya Police Station", lat: 7.3175, lng: 80.9830, area: "Mahiyanganaya" },
  { name: "Haputale Police Station", lat: 6.7667, lng: 80.9500, area: "Haputale" },
  { name: "Welimada Police Station", lat: 6.9000, lng: 80.9167, area: "Welimada" },
  { name: "Passara Police Station", lat: 6.9366, lng: 81.1527, area: "Passara" },

  // --- Monaragala District ---
  { name: "Monaragala Police Station", lat: 6.8720, lng: 81.3500, area: "Monaragala" },
  { name: "Wellawaya Police Station", lat: 6.7380, lng: 81.1027, area: "Wellawaya" },
  { name: "Bibile Police Station", lat: 7.1650, lng: 81.2223, area: "Bibile" },
  { name: "Buttala Police Station", lat: 6.7578, lng: 81.2427, area: "Buttala" },
  { name: "Siyambalanduwa Police Station", lat: 6.9079, lng: 81.5471, area: "Siyambalanduwa" },

  // --- Ratnapura District ---
  { name: "Ratnapura Police Station", lat: 6.6828, lng: 80.3992, area: "Ratnapura" },
  { name: "Embilipitiya Police Station", lat: 6.3353, lng: 80.8507, area: "Embilipitiya" },
  { name: "Balangoda Police Station", lat: 6.6473, lng: 80.7028, area: "Balangoda" },
  { name: "Eheliyagoda Police Station", lat: 6.8481, lng: 80.2625, area: "Eheliyagoda" },
  { name: "Pelmadulla Police Station", lat: 6.6264, lng: 80.5422, area: "Pelmadulla" },
  { name: "Kuruwita Police Station", lat: 6.7667, lng: 80.3667, area: "Kuruwita" },

  // --- Kegalle District ---
  { name: "Kegalle Police Station", lat: 7.2514, lng: 80.3464, area: "Kegalle" },
  { name: "Mawanella Police Station", lat: 7.2515, lng: 80.4475, area: "Mawanella" },
  { name: "Rambukkana Police Station", lat: 7.3235, lng: 80.3916, area: "Rambukkana" },
  { name: "Warakapola Police Station", lat: 7.2269, lng: 80.1982, area: "Warakapola" },
  { name: "Yatiyantota Police Station", lat: 7.0272, lng: 80.2974, area: "Yatiyantota" },
  { name: "Ruwanwella Police Station", lat: 7.0381, lng: 80.2520, area: "Ruwanwella" }
];

function toRad(value) {
  return (value * Math.PI) / 180;
}

// Haversine formula to calculate distance in km
function calcDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // km
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
    Math.cos(toRad(lat1)) *
      Math.cos(toRad(lat2)) *
      Math.sin(dLon / 2) *
      Math.sin(dLon / 2);
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

export function findNearestPoliceStations(lat, lng, limit = 3) {
  if (!lat || !lng) return [];

  // Optimization: "Bounding Box" Filter
  // 1 degree lat is approx 111km.
  // We first filter stations within ~50km (approx 0.5 deg) using simple math.
  // This avoids running the expensive Haversine trig formula on all 500+ stations.
  
  const THRESHOLD_DEG = 0.5; // ~55km radius box
  
  let candidates = POLICE_STATIONS.filter(s => 
    Math.abs(s.lat - lat) < THRESHOLD_DEG && 
    Math.abs(s.lng - lng) < THRESHOLD_DEG
  );

  // Fallback: If no stations in range (remote area), use the full list
  if (candidates.length === 0) {
    candidates = POLICE_STATIONS;
  }

  // Now run accurate calculation on the smaller list
  const stationsWithDist = candidates.map((station) => ({
    ...station,
    distanceKm: calcDistance(lat, lng, station.lat, station.lng),
  }));

  stationsWithDist.sort((a, b) => a.distanceKm - b.distanceKm);
  return stationsWithDist.slice(0, limit);
}
